services:
  coach-server:
    image: slack-coach:latest
    container_name: slack_coach_server
    env_file:
      - .env
    environment:
      - RUN_MODE=server
      - STATE_DIR=/app/state
    ports:
      - "8080:8080"
    volumes:
      - "${HOST_STATE_DIR:-./state}:/app/state"
    restart: unless-stopped

  coach-job:
    image: slack-coach:latest
    container_name: slack_coach_job
    env_file:
      - .env
    environment:
      - RUN_MODE=job
      - STATE_DIR=/app/state
    volumes:
      - "${HOST_STATE_DIR:-./state}:/app/state"
    # The job is intended to run and exit; use `docker compose run --rm coach-job` to execute manually
    restart: "no"

  coach-cron:
    image: slack-coach:latest
    container_name: slack_coach_cron
    env_file:
      - .env
    environment:
      - RUN_MODE=cron
      - STATE_DIR=/app/state
    volumes:
      - "${HOST_STATE_DIR:-./state}:/app/state"
    restart: unless-stopped
